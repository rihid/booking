import React from 'react';
import { Metadata } from 'next';
import Container from '@/components/ui/container';
import Image from 'next/image';
import { Input } from '@/components/ui/input';
import { Search } from 'lucide-react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Suspense } from 'react';
import ProductList from './module/product-list';
import { ProductListLoader, UserAvatarLoader } from '@/components/partial/loader';
import UserAvatar from './module/user-avatar';
import HomepageSearch from '@/components/partial/homepage-search';
import axios from 'axios';
import { productUrl } from '@/lib/data/endpoints';

export const metadata: Metadata = {
  title: 'Explore',
  description: 'Generated by create next app'
}

async function Explore({
  searchParams,
}: {
  searchParams?: {
    query?: string;
  }
}) {
  const query = searchParams?.query || '';
  const getProductType = async () => {
    try {
      const res = await axios.get(productUrl + "/category", {
        headers: {
          Accept: 'application/json',
        }
      });
      const data = res.data.data;
      return data;
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
  const categories = await getProductType();
  const categorySelected = categories.reverse()

  return (
    <div className="flex flex-col min-h-screen">
      <Tabs defaultValue={categorySelected[0].id}>
        <Container className="mt-6 mb-4 space-y-4">
          <Suspense fallback={<UserAvatarLoader />}>
            <UserAvatar />
          </Suspense>
          <HomepageSearch />
        </Container>
        <Container el="nav" className="sticky top-0 z-30 bg-background pb-4 pt-1 border-b shadow-md rounded-b-3xl">
          <TabsList className="flex gap-6 justify-start bg-background text-muted-foreground">
            {categorySelected.map((item: any, index: number) =>
              <TabsTrigger key={index} value={item.id} className="font-bold">{item.name}</TabsTrigger>
            )}
          </TabsList>
        </Container>
        <div className="relative mt-6 mb-20">
          {categorySelected.map((item: any, index: number) =>
            <TabsContent key={index} value={item.id}>
              <Suspense fallback={<ProductListLoader />}>
                <ProductList query={query} />
              </Suspense>
            </TabsContent>
          )}
          {/* <TabsContent value='coastal'>
            testing 2
          </TabsContent>
          <TabsContent value='rental'>
            testing
          </TabsContent> */}
        </div>
      </Tabs>
    </div>
  )
}

export default Explore;